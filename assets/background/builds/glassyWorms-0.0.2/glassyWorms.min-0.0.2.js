// Plugin glassy-worms. Beautiful worms on background
// Aunthor: Nick Iv. Sorced 17 May 2014
// Promo: http://dev.nim579.ru/glassy-worms
// Version: 0.0.2 (Sat May 17 2014 14:29:43)
(function(){$.glassyWorms={version:"0.0.2",Particle:function(){function a(a,b,c,d){this.x=null!=a?a:0,this.y=null!=b?b:0,this.mass=null!=c?c:1,null==d&&(d=["#000000"]),this.tail=[],this.radius=.15*this.mass,this.charge=random([-1,1]),this.color=random(d),this.fx=this.fy=0,this.vx=this.vy=0}return a}(),setup:function(){var a,b,c,d,e,f,g;for(g=[],a=e=0,f=this.glassyWormsOptins.numParticles;f>=e;a=e+=1)c=random(this.width),d=random(this.height),b=random(8,14),g.push(this.particles.push(new $.glassyWorms.Particle(c,d,b,this.glassyWormsOptins.colors)));return g},draw:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;for(this.lineCap=this.lineJoin="round",w=[],j=o=0,s=this.glassyWormsOptins.numParticles;s>=o;j=o+=1){for(a=this.particles[j],random()<.5&&(a.charge=-a.charge),k=p=t=j+1,u=this.glassyWormsOptins.numParticles;u>=p;k=p+=1)b=this.particles[k],e=b.x-a.x,f=b.y-a.y,d=sqrt(c=e*e+f*f+.1),n=a.radius+b.radius,d>=n&&(l=1/d,h=e*l,i=f*l,g=min(this.glassyWormsOptins.maxForce,this.glassyWormsOptins.gravity*a.mass*b.mass/c),a.fx+=g*h*b.charge,a.fy+=g*i*b.charge,b.fx+=-g*h*a.charge,b.fy+=-g*i*a.charge);for(a.vx+=a.fx,a.vy+=a.fy,a.vx*=this.glassyWormsOptins.friction,a.vy*=this.glassyWormsOptins.friction,a.tail.unshift({x:a.x,y:a.y}),a.tail.length>this.glassyWormsOptins.tailLength&&a.tail.pop(),a.x+=a.vx,a.y+=a.vy,a.fx=a.fy=0,a.x>this.width+a.radius?(a.x=-a.radius,a.tail=[]):a.x<-a.radius&&(a.x=this.width+a.radius,a.tail=[]),a.y>this.height+a.radius?(a.y=-a.radius,a.tail=[]):a.y<-a.radius&&(a.y=this.height+a.radius,a.tail=[]),this.strokeStyle=a.color,this.lineWidth=.1*a.radius,this.beginPath(),this.moveTo(a.x,a.y),v=a.tail,q=0,r=v.length;r>q;q++)m=v[q],this.lineTo(m.x,m.y);w.push(this.stroke())}return w}},$.fn.glassyWorms=function(a){var b;return"string"==typeof a?(this.each(function(b,c){var d,e;return console.log(c.glassyWorms,null!=(d=c.glassyWorms)?d[a]:void 0),null!=(e=c.glassyWorms)&&"function"==typeof e[a]?e[a]():void 0}),this):(a=$.extend({numParticles:250,tailLength:12,maxForce:8,friction:.75,gravity:9.81,interval:3,colors:["#fff"],element:$('<canvas class="worms"></canvas>')[0],useStyles:!1},a),(a.className||a.id)&&(b=$("<canvas></canvas>"),a.className&&b.addClass(a.className),a.id&&b.attr("id",a.id),a.element=b[0]),a.useStyles&&(b=$(a.element),b.css({position:"absolute",top:0,bottom:0,right:0,left:0}),a.element=b[0]),this.each(function(b,c){return c.glassyWorms=Sketch.create({container:c,element:a.element,particles:[],interval:a.interval,setup:$.glassyWorms.setup,draw:$.glassyWorms.draw,glassyWormsOptins:a})}),this)}}).call(this);